<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BYOF Example - Vanilla JS</title>
    <style>
      :root {
        --primary: #2563eb;
        --primary-hover: #1d4ed8;
        --primary-light: #eff6ff;
        --bg: #ffffff;
        --bg-secondary: #f8fafc;
        --bg-tertiary: #f1f5f9;
        --text: #0f172a;
        --text-secondary: #475569;
        --text-muted: #94a3b8;
        --border: #e2e8f0;
        --border-light: #f1f5f9;
        --error: #dc2626;
        --success: #16a34a;
        --radius: 12px;
        --radius-sm: 8px;
        --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        --shadow-lg:
          0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', Roboto,
          sans-serif;
        background: var(--bg-secondary);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        color: var(--text);
        -webkit-font-smoothing: antialiased;
      }

      /* BYOF mount container */
      #byof-mount {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      /* ========================================
         Setup Screen - shown before initialization
         ======================================== */
      .setup-screen {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: var(--bg);
      }

      .setup-header {
        padding: 20px 24px;
        border-bottom: 1px solid var(--border-light);
        background: var(--bg);
      }

      .setup-header h1 {
        font-size: 18px;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 2px;
      }

      .setup-header p {
        font-size: 13px;
        color: var(--text-muted);
      }

      .setup-body {
        flex: 1;
        padding: 24px;
        background: var(--bg-secondary);
        overflow-y: auto;
      }

      .setup-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        max-width: 1200px;
      }

      .setup-section {
        background: var(--bg);
        border-radius: var(--radius);
        padding: 20px;
        box-shadow: var(--shadow);
      }

      .setup-section-title {
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--text-muted);
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid var(--border-light);
      }

      .setup-field {
        margin-bottom: 14px;
      }

      .setup-field:last-child {
        margin-bottom: 0;
      }

      .setup-field label {
        display: block;
        font-size: 13px;
        font-weight: 500;
        color: var(--text-secondary);
        margin-bottom: 6px;
      }

      .setup-field input[type='url'],
      .setup-field input[type='text'],
      .setup-field select {
        width: 100%;
        padding: 10px 14px;
        border: 1px solid var(--border);
        border-radius: var(--radius-sm);
        font-family: inherit;
        font-size: 14px;
        color: var(--text);
        background: var(--bg);
        transition:
          border-color 0.15s,
          box-shadow 0.15s;
      }

      .setup-field input::placeholder {
        color: var(--text-muted);
      }

      .setup-field input:focus,
      .setup-field select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px var(--primary-light);
      }

      .setup-field select {
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        padding-right: 36px;
        cursor: pointer;
      }

      .setup-options-row {
        display: flex;
        gap: 16px;
        align-items: flex-end;
      }

      .setup-options-row .setup-field {
        flex: 1;
        margin-bottom: 0;
      }

      /* Checkbox styling */
      .setup-checkbox {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        font-size: 14px;
        color: var(--text-secondary);
        height: 42px;
      }

      .setup-checkbox input[type='checkbox'] {
        width: 18px;
        height: 18px;
        border-radius: 4px;
        border: 1px solid var(--border);
        cursor: pointer;
        accent-color: var(--primary);
      }

      /* Buttons */
      .setup-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 24px;
        border: none;
        border-radius: var(--radius-sm);
        font-family: inherit;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.15s;
      }

      .setup-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .setup-btn-primary {
        background: var(--primary);
        color: white;
      }

      .setup-btn-primary:hover:not(:disabled) {
        background: var(--primary-hover);
      }

      .setup-btn-primary:active:not(:disabled) {
        transform: scale(0.98);
      }

      /* Help text / tips */
      .setup-tips {
        background: var(--bg);
        border-radius: var(--radius);
        padding: 20px;
        box-shadow: var(--shadow);
      }

      .setup-tips-title {
        font-size: 12px;
        font-weight: 600;
        color: var(--text-secondary);
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .setup-tips-title svg {
        width: 14px;
        height: 14px;
        color: var(--text-muted);
      }

      .setup-tips ol {
        margin: 0;
        padding-left: 18px;
        font-size: 13px;
        color: var(--text-secondary);
        line-height: 1.8;
      }

      .setup-tips code {
        font-family: 'SF Mono', Monaco, Menlo, monospace;
        font-size: 12px;
        background: var(--bg-tertiary);
        padding: 2px 6px;
        border-radius: 4px;
        color: var(--text);
      }

      /* Actions bar at bottom */
      .setup-footer {
        padding: 16px 24px;
        background: var(--bg);
        border-top: 1px solid var(--border-light);
        display: flex;
        justify-content: flex-end;
      }

      /* ========================================
         Event Log - Developer console
         ======================================== */
      .event-log {
        background: #0f172a;
        color: #94a3b8;
        font-family: 'SF Mono', Monaco, Menlo, monospace;
        font-size: 12px;
        max-height: 140px;
        overflow-y: auto;
        border-top: 1px solid #1e293b;
      }

      .event-log-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 16px;
        background: #1e293b;
        border-bottom: 1px solid #334155;
        position: sticky;
        top: 0;
      }

      .event-log-header span {
        font-size: 11px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: #64748b;
      }

      .event-log-header button {
        background: transparent;
        border: 1px solid #334155;
        color: #64748b;
        padding: 4px 10px;
        font-size: 11px;
        font-family: inherit;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.15s;
      }

      .event-log-header button:hover {
        color: #94a3b8;
        border-color: #475569;
        background: #334155;
      }

      .event-log-content {
        padding: 12px 16px;
      }

      .event-log-entry {
        margin: 4px 0;
        line-height: 1.5;
      }

      .event-log-entry .timestamp {
        color: #475569;
      }

      .event-log-entry.error {
        color: #f87171;
      }

      .event-log-entry.info {
        color: #60a5fa;
      }

      /* ========================================
         Hide setup when initialized
         ======================================== */
      body.byof-initialized .setup-screen {
        display: none;
      }

      /* Show destroy button in header when initialized */
      .header-destroy-btn {
        display: none;
        padding: 6px 12px;
        background: transparent;
        border: 1px solid #334155;
        color: #94a3b8;
        font-size: 12px;
        font-family: inherit;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.15s;
      }

      .header-destroy-btn:hover {
        background: #334155;
        color: #f1f5f9;
      }

      body.byof-initialized .header-destroy-btn {
        display: inline-flex;
      }

      /* Responsive */
      @media (max-width: 640px) {
        .setup-header,
        .setup-footer {
          padding: 16px 20px;
        }

        .setup-body {
          padding: 20px;
        }

        .setup-grid {
          grid-template-columns: 1fr;
        }

        .setup-section {
          padding: 16px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Setup Screen - Configuration UI -->
    <div class="setup-screen">
      <div class="setup-header">
        <h1>BYOF Setup</h1>
        <p>Configure your AI-powered UI generator</p>
      </div>

      <div class="setup-body">
        <div class="setup-grid">
          <!-- Endpoints Section -->
          <div class="setup-section">
            <div class="setup-section-title">Endpoints</div>

            <div class="setup-field">
              <label for="chat-endpoint">Chat Endpoint</label>
              <input
                type="url"
                id="chat-endpoint"
                value="http://localhost:3001/api/chat"
                placeholder="https://api.example.com/chat"
              />
            </div>

            <div class="setup-field">
              <label for="save-endpoint">Save Endpoint (optional)</label>
              <input
                type="url"
                id="save-endpoint"
                value="http://localhost:3001/api/save"
                placeholder="https://api.example.com/save"
              />
            </div>

            <div class="setup-field">
              <label for="api-spec-url">API Spec URL (optional)</label>
              <input
                type="url"
                id="api-spec-url"
                placeholder="https://api.example.com/openapi.json"
              />
            </div>

            <div class="setup-field">
              <label for="default-html-url">Default HTML URL (optional)</label>
              <input
                type="url"
                id="default-html-url"
                value="http://localhost:3001/api/default-html"
                placeholder="https://api.example.com/default-html"
              />
            </div>
          </div>

          <!-- Options Section -->
          <div class="setup-section">
            <div class="setup-section-title">Options</div>

            <div class="setup-field">
              <label for="theme-select">Theme</label>
              <select id="theme-select">
                <option value="default">Default</option>
                <option value="dark">Dark</option>
                <option value="brand">Brand Colors</option>
              </select>
            </div>

            <div class="setup-field">
              <label class="setup-checkbox">
                <input type="checkbox" id="auth-toggle" checked />
                Enable Auth (JWT)
              </label>
            </div>
          </div>

          <!-- Tips -->
          <div class="setup-tips">
            <div class="setup-tips-title">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="12" cy="12" r="10" />
                <path d="M12 16v-4" />
                <path d="M12 8h.01" />
              </svg>
              Quick Start
            </div>
            <ol>
              <li>Run <code>npm run build</code> to build the SDK</li>
              <li>
                Start backend: <code>cd examples/backend && npm start</code>
              </li>
              <li>Serve from root: <code>npx serve .</code></li>
              <li>Click Initialize and try: "create a user dashboard"</li>
            </ol>
          </div>
        </div>
      </div>

      <div class="setup-footer">
        <button class="setup-btn setup-btn-primary" id="init-btn">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <polygon points="5 3 19 12 5 21 5 3" />
          </svg>
          Initialize BYOF
        </button>
      </div>
    </div>

    <!-- BYOF mount point -->
    <div id="byof-mount"></div>

    <!-- Event log -->
    <div class="event-log">
      <div class="event-log-header">
        <span>Console</span>
        <div style="display: flex; gap: 8px">
          <button class="header-destroy-btn" id="destroy-btn">
            Destroy Instance
          </button>
          <button id="clear-log-btn">Clear</button>
        </div>
      </div>
      <div class="event-log-content" id="event-log-content"></div>
    </div>

    <!-- Load BYOF SDK - browser bundle with all dependencies included -->
    <script src="/dist/index.browser.js"></script>
    <script>
      // The browser bundle exposes BYOF as a global
      const { createByof, VERSION } = BYOF

      // Demo API spec - describes the actual REST API endpoints on the backend
      // The backend (localhost:3001) implements these endpoints with in-memory data
      const demoApiSpec = JSON.stringify(
        {
          openapi: '3.0.0',
          info: {
            title: 'User Management API',
            version: '1.0.0',
            description:
              'A simple REST API for managing users. Base URL: http://localhost:3001',
          },
          servers: [
            {
              url: 'http://localhost:3001',
              description: 'Local development server',
            },
          ],
          paths: {
            '/users': {
              get: {
                summary: 'List all users',
                description: 'Returns an array of all users in the system',
                responses: {
                  200: {
                    description: 'Array of user objects',
                    content: {
                      'application/json': {
                        example: [
                          {
                            id: 1,
                            name: 'Alice Johnson',
                            email: 'alice@example.com',
                            role: 'admin',
                            createdAt: '2024-01-15T10:00:00Z',
                          },
                          {
                            id: 2,
                            name: 'Bob Smith',
                            email: 'bob@example.com',
                            role: 'user',
                            createdAt: '2024-02-20T14:30:00Z',
                          },
                        ],
                      },
                    },
                  },
                },
              },
              post: {
                summary: 'Create a new user',
                description:
                  'Creates a new user and returns the created user object',
                requestBody: {
                  required: true,
                  content: {
                    'application/json': {
                      schema: {
                        type: 'object',
                        required: ['name', 'email'],
                        properties: {
                          name: { type: 'string', example: 'John Doe' },
                          email: {
                            type: 'string',
                            format: 'email',
                            example: 'john@example.com',
                          },
                          role: {
                            type: 'string',
                            enum: ['admin', 'moderator', 'user'],
                            default: 'user',
                          },
                        },
                      },
                    },
                  },
                },
                responses: {
                  201: { description: 'User created successfully' },
                  400: { description: 'Missing required fields (name, email)' },
                  409: { description: 'Email already exists' },
                },
              },
            },
            '/users/{id}': {
              get: {
                summary: 'Get user by ID',
                description: 'Returns a single user by their ID',
                parameters: [
                  {
                    name: 'id',
                    in: 'path',
                    required: true,
                    schema: { type: 'integer' },
                  },
                ],
                responses: {
                  200: { description: 'User object' },
                  404: { description: 'User not found' },
                },
              },
              put: {
                summary: 'Update user',
                description:
                  'Updates an existing user. All fields are optional.',
                parameters: [
                  {
                    name: 'id',
                    in: 'path',
                    required: true,
                    schema: { type: 'integer' },
                  },
                ],
                requestBody: {
                  content: {
                    'application/json': {
                      schema: {
                        type: 'object',
                        properties: {
                          name: { type: 'string' },
                          email: { type: 'string', format: 'email' },
                          role: {
                            type: 'string',
                            enum: ['admin', 'moderator', 'user'],
                          },
                        },
                      },
                    },
                  },
                },
                responses: {
                  200: { description: 'Updated user object' },
                  404: { description: 'User not found' },
                  409: { description: 'Email already exists' },
                },
              },
              delete: {
                summary: 'Delete user',
                description: 'Deletes a user by their ID',
                parameters: [
                  {
                    name: 'id',
                    in: 'path',
                    required: true,
                    schema: { type: 'integer' },
                  },
                ],
                responses: {
                  204: { description: 'User deleted (no content)' },
                  404: { description: 'User not found' },
                },
              },
            },
          },
        },
        null,
        2
      )

      // Theme presets
      const themes = {
        default: {},
        dark: {
          primaryColor: '#6c5ce7',
          backgroundColor: '#1a1a2e',
          textColor: '#e0e0e0',
          borderColor: '#3a3a5e',
          errorColor: '#ff6b6b',
          successColor: '#55efc4',
          // Additional dark theme variables
          customVariables: {
            'byof-bg-secondary': '#2a2a4e',
            'byof-text-muted': '#a0a0b0',
            'byof-error-bg': '#3a2020',
          },
        },
        brand: {
          primaryColor: '#e74c3c',
          backgroundColor: '#fdf2f2',
          textColor: '#2c3e50',
          borderColor: '#fadbd8',
          successColor: '#27ae60',
        },
      }

      // State
      let byofInstance = null

      // Demo JWT token (for demonstration purposes)
      // In a real app, this would come from your auth service
      const DEMO_JWT =
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyLTEyMyIsIm5hbWUiOiJKb2huIERvZSIsImVtYWlsIjoiam9obkBleGFtcGxlLmNvbSIsInJvbGUiOiJhZG1pbiIsImlhdCI6MTcwNDAwMDAwMCwiZXhwIjoxODA0MDAwMDAwfQ.demo-signature'

      // DOM elements
      const chatEndpointInput = document.getElementById('chat-endpoint')
      const saveEndpointInput = document.getElementById('save-endpoint')
      const apiSpecUrlInput = document.getElementById('api-spec-url')
      const defaultHtmlUrlInput = document.getElementById('default-html-url')
      const themeSelect = document.getElementById('theme-select')
      const authToggle = document.getElementById('auth-toggle')
      const initBtn = document.getElementById('init-btn')
      const destroyBtn = document.getElementById('destroy-btn')
      const clearLogBtn = document.getElementById('clear-log-btn')
      const eventLogContent = document.getElementById('event-log-content')
      const mountEl = document.getElementById('byof-mount')

      // Event logging
      function logEvent(type, message, data = null) {
        const timestamp = new Date().toLocaleTimeString()
        const entry = document.createElement('div')
        entry.className = `event-log-entry ${type}`

        let text = `<span class="timestamp">[${timestamp}]</span> ${message}`
        if (data) {
          text += ` ${JSON.stringify(data)}`
        }
        entry.innerHTML = text

        eventLogContent.appendChild(entry)
        eventLogContent.scrollTop = eventLogContent.scrollHeight
      }

      // Initialize BYOF
      function initByof() {
        if (byofInstance) {
          logEvent('error', 'BYOF already initialized. Destroy first.')
          return
        }

        const chatEndpoint = chatEndpointInput.value.trim()
        if (!chatEndpoint) {
          logEvent('error', 'Chat endpoint is required')
          return
        }

        const saveEndpoint = saveEndpointInput.value.trim() || undefined
        const apiSpecUrl = apiSpecUrlInput.value.trim() || undefined
        const defaultHtmlUrl = defaultHtmlUrlInput.value.trim() || undefined
        const theme = themes[themeSelect.value] || {}

        // Use demo API spec if no URL provided
        const apiSpec = apiSpecUrl ? undefined : demoApiSpec

        logEvent('info', `Initializing BYOF v${VERSION}...`)

        // Build config object
        const config = {
          mount: mountEl,
          chatEndpoint,
          saveEndpoint,
          apiSpecUrl,
          apiSpec,
          defaultHtmlUrl,
          theme,
          projectId: 'example-project',
          userId: 'example-user',
          sandbox: {
            allowlist: ['http://localhost:3001'],
          },
          onHtmlGenerated: (html, title) => {
            logEvent('info', 'HTML Generated', {
              title,
              htmlLength: html.length,
            })
          },
          onError: (error) => {
            logEvent('error', `Error: ${error.message}`, { code: error.code })
          },
          onSaveComplete: (ref) => {
            logEvent('info', 'Saved', { id: ref.id, name: ref.name })
          },
          onLoadComplete: (ref) => {
            logEvent('info', 'Loaded', { id: ref.id, name: ref.name })
          },
        }

        // Add auth if enabled
        if (authToggle.checked) {
          config.getAuthHeaders = () => {
            logEvent('info', 'Auth headers requested (JWT injected)')
            return {
              Authorization: `Bearer ${DEMO_JWT}`,
              'X-User-ID': 'user-123',
              'X-Tenant-ID': 'tenant-456',
            }
          }
        }

        try {
          byofInstance = createByof(config)

          logEvent('info', 'BYOF initialized successfully')
          initBtn.disabled = true
          destroyBtn.disabled = false
          document.body.classList.add('byof-initialized')
        } catch (err) {
          logEvent('error', `Failed to initialize: ${err.message}`)
        }
      }

      // Destroy BYOF
      function destroyByof() {
        if (!byofInstance) {
          logEvent('error', 'BYOF not initialized')
          return
        }

        byofInstance.destroy()
        byofInstance = null

        logEvent('info', 'BYOF destroyed')
        initBtn.disabled = false
        destroyBtn.disabled = true
        document.body.classList.remove('byof-initialized')
      }

      // Clear log
      function clearLog() {
        eventLogContent.innerHTML = ''
      }

      // Event listeners
      initBtn.addEventListener('click', initByof)
      destroyBtn.addEventListener('click', destroyByof)
      clearLogBtn.addEventListener('click', clearLog)

      // Auto-initialize on page load
      logEvent('info', `BYOF SDK v${VERSION} loaded`)
      logEvent('info', 'Click "Initialize" to start')
    </script>
  </body>
</html>
