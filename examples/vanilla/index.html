<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BYOF Example - Vanilla JS</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #f5f7fa;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      /* Example page header */
      .example-header {
        background: #1a1a2e;
        color: white;
        padding: 16px 24px;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .example-header h1 {
        font-size: 18px;
        font-weight: 600;
      }

      .example-header a {
        color: #8b8b9e;
        text-decoration: none;
        font-size: 14px;
      }

      .example-header a:hover {
        color: white;
      }

      /* Config panel */
      .config-panel {
        background: white;
        border-bottom: 1px solid #e0e0e0;
        padding: 16px 24px;
      }

      .config-row {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        align-items: flex-end;
      }

      .config-field {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .config-field label {
        font-size: 12px;
        font-weight: 500;
        color: #666;
      }

      .config-field input,
      .config-field select {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        min-width: 200px;
      }

      .config-field input:focus,
      .config-field select:focus {
        outline: none;
        border-color: #0066cc;
      }

      .config-actions {
        display: flex;
        gap: 8px;
      }

      .config-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .config-btn-primary {
        background: #0066cc;
        color: white;
      }

      .config-btn-primary:hover {
        background: #0052a3;
      }

      .config-btn-secondary {
        background: #e0e0e0;
        color: #333;
      }

      .config-btn-secondary:hover {
        background: #d0d0d0;
      }

      /* BYOF mount container */
      #byof-mount {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      /* Event log */
      .event-log {
        background: #1a1a2e;
        color: #a0ffa0;
        font-family: 'Monaco', 'Menlo', monospace;
        font-size: 12px;
        padding: 16px;
        max-height: 150px;
        overflow-y: auto;
      }

      .event-log-header {
        color: #8b8b9e;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .event-log-header button {
        background: transparent;
        border: 1px solid #8b8b9e;
        color: #8b8b9e;
        padding: 4px 8px;
        font-size: 11px;
        border-radius: 4px;
        cursor: pointer;
      }

      .event-log-header button:hover {
        color: white;
        border-color: white;
      }

      .event-log-entry {
        margin: 2px 0;
        line-height: 1.4;
      }

      .event-log-entry .timestamp {
        color: #666;
      }

      .event-log-entry.error {
        color: #ff6b6b;
      }

      .event-log-entry.info {
        color: #74b9ff;
      }

      /* Notice for demo mode */
      .demo-notice {
        background: #fff3cd;
        border: 1px solid #ffc107;
        color: #856404;
        padding: 12px 16px;
        margin: 16px 24px;
        border-radius: 6px;
        font-size: 14px;
      }

      .demo-notice strong {
        display: block;
        margin-bottom: 4px;
      }
    </style>
  </head>
  <body>
    <!-- Example page header -->
    <header class="example-header">
      <h1>BYOF Example</h1>
      <a href="https://github.com/your-org/byof" target="_blank"
        >View on GitHub</a
      >
    </header>

    <!-- Configuration panel -->
    <div class="config-panel">
      <div class="config-row">
        <div class="config-field">
          <label for="chat-endpoint">Chat Endpoint</label>
          <input
            type="url"
            id="chat-endpoint"
            value="http://localhost:3001/api/chat"
            placeholder="http://localhost:3001/api/chat"
          />
        </div>
        <div class="config-field">
          <label for="save-endpoint">Save Endpoint (optional)</label>
          <input
            type="url"
            id="save-endpoint"
            value="http://localhost:3001/api/save"
            placeholder="http://localhost:3001/api/save"
          />
        </div>
        <div class="config-field">
          <label for="api-spec-url">API Spec URL (optional)</label>
          <input
            type="url"
            id="api-spec-url"
            placeholder="https://api.example.com/openapi.json"
          />
        </div>
        <div class="config-field">
          <label for="theme-select">Theme</label>
          <select id="theme-select">
            <option value="default">Default</option>
            <option value="dark">Dark</option>
            <option value="brand">Brand Colors</option>
          </select>
        </div>
        <div class="config-actions">
          <button class="config-btn config-btn-primary" id="init-btn">
            Initialize
          </button>
          <button
            class="config-btn config-btn-secondary"
            id="destroy-btn"
            disabled
          >
            Destroy
          </button>
        </div>
      </div>
    </div>

    <!-- Demo notice -->
    <div class="demo-notice">
      <strong>Demo Mode</strong>
      This example requires a running backend. Start the example backend with:
      <code>cd examples/backend && npm start</code>
    </div>

    <!-- BYOF mount point -->
    <div id="byof-mount"></div>

    <!-- Event log -->
    <div class="event-log">
      <div class="event-log-header">
        <span>Event Log</span>
        <button id="clear-log-btn">Clear</button>
      </div>
      <div id="event-log-content"></div>
    </div>

    <!-- Load BYOF SDK - in production this would be from npm -->
    <script type="module">
      // In production: import { createByof } from 'byof'
      // For development, we import from the dist folder
      import { createByof, VERSION } from '../../dist/index.js'

      // Theme presets
      const themes = {
        default: {},
        dark: {
          primaryColor: '#6c5ce7',
          backgroundColor: '#1a1a2e',
          textColor: '#e0e0e0',
          borderColor: '#3a3a5e',
          errorColor: '#ff6b6b',
          successColor: '#55efc4',
        },
        brand: {
          primaryColor: '#e74c3c',
          backgroundColor: '#fdf2f2',
          textColor: '#2c3e50',
          borderColor: '#fadbd8',
          successColor: '#27ae60',
        },
      }

      // State
      let byofInstance = null

      // DOM elements
      const chatEndpointInput = document.getElementById('chat-endpoint')
      const saveEndpointInput = document.getElementById('save-endpoint')
      const apiSpecUrlInput = document.getElementById('api-spec-url')
      const themeSelect = document.getElementById('theme-select')
      const initBtn = document.getElementById('init-btn')
      const destroyBtn = document.getElementById('destroy-btn')
      const clearLogBtn = document.getElementById('clear-log-btn')
      const eventLogContent = document.getElementById('event-log-content')
      const mountEl = document.getElementById('byof-mount')

      // Event logging
      function logEvent(type, message, data = null) {
        const timestamp = new Date().toLocaleTimeString()
        const entry = document.createElement('div')
        entry.className = `event-log-entry ${type}`

        let text = `<span class="timestamp">[${timestamp}]</span> ${message}`
        if (data) {
          text += ` ${JSON.stringify(data)}`
        }
        entry.innerHTML = text

        eventLogContent.appendChild(entry)
        eventLogContent.scrollTop = eventLogContent.scrollHeight
      }

      // Initialize BYOF
      function initByof() {
        if (byofInstance) {
          logEvent('error', 'BYOF already initialized. Destroy first.')
          return
        }

        const chatEndpoint = chatEndpointInput.value.trim()
        if (!chatEndpoint) {
          logEvent('error', 'Chat endpoint is required')
          return
        }

        const saveEndpoint = saveEndpointInput.value.trim() || undefined
        const apiSpecUrl = apiSpecUrlInput.value.trim() || undefined
        const theme = themes[themeSelect.value] || {}

        logEvent('info', `Initializing BYOF v${VERSION}...`)

        try {
          byofInstance = createByof({
            mount: mountEl,
            chatEndpoint,
            saveEndpoint,
            apiSpecUrl,
            theme,
            projectId: 'example-project',
            userId: 'example-user',
            sandbox: {
              allowlist: ['https://api.example.com', 'http://localhost:*'],
            },
            onHtmlGenerated: (html, title) => {
              logEvent('info', 'HTML Generated', {
                title,
                htmlLength: html.length,
              })
            },
            onError: (error) => {
              logEvent('error', `Error: ${error.message}`, { code: error.code })
            },
            onSaveComplete: (ref) => {
              logEvent('info', 'Saved', { id: ref.id, name: ref.name })
            },
            onLoadComplete: (ref) => {
              logEvent('info', 'Loaded', { id: ref.id, name: ref.name })
            },
          })

          logEvent('info', 'BYOF initialized successfully')
          initBtn.disabled = true
          destroyBtn.disabled = false
        } catch (err) {
          logEvent('error', `Failed to initialize: ${err.message}`)
        }
      }

      // Destroy BYOF
      function destroyByof() {
        if (!byofInstance) {
          logEvent('error', 'BYOF not initialized')
          return
        }

        byofInstance.destroy()
        byofInstance = null

        logEvent('info', 'BYOF destroyed')
        initBtn.disabled = false
        destroyBtn.disabled = true
      }

      // Clear log
      function clearLog() {
        eventLogContent.innerHTML = ''
      }

      // Event listeners
      initBtn.addEventListener('click', initByof)
      destroyBtn.addEventListener('click', destroyByof)
      clearLogBtn.addEventListener('click', clearLog)

      // Auto-initialize on page load
      logEvent('info', `BYOF SDK v${VERSION} loaded`)
      logEvent('info', 'Click "Initialize" to start')
    </script>
  </body>
</html>
