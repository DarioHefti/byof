<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BYOF Example - Vanilla JS</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #f5f7fa;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      /* Example page header */
      .example-header {
        background: #1a1a2e;
        color: white;
        padding: 16px 24px;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .example-header h1 {
        font-size: 18px;
        font-weight: 600;
      }

      .example-header a {
        color: #8b8b9e;
        text-decoration: none;
        font-size: 14px;
      }

      .example-header a:hover {
        color: white;
      }

      /* Config panel */
      .config-panel {
        background: white;
        border-bottom: 1px solid #e0e0e0;
        padding: 16px 24px;
      }

      .config-row {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        align-items: flex-end;
      }

      .config-field {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .config-field label {
        font-size: 12px;
        font-weight: 500;
        color: #666;
      }

      .config-field input,
      .config-field select {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
        min-width: 200px;
      }

      .config-field input:focus,
      .config-field select:focus {
        outline: none;
        border-color: #0066cc;
      }

      .config-actions {
        display: flex;
        gap: 8px;
      }

      .config-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .config-btn-primary {
        background: #0066cc;
        color: white;
      }

      .config-btn-primary:hover {
        background: #0052a3;
      }

      .config-btn-secondary {
        background: #e0e0e0;
        color: #333;
      }

      .config-btn-secondary:hover {
        background: #d0d0d0;
      }

      /* BYOF mount container */
      #byof-mount {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      /* Event log */
      .event-log {
        background: #1a1a2e;
        color: #a0ffa0;
        font-family: 'Monaco', 'Menlo', monospace;
        font-size: 12px;
        padding: 16px;
        max-height: 150px;
        overflow-y: auto;
      }

      .event-log-header {
        color: #8b8b9e;
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .event-log-header button {
        background: transparent;
        border: 1px solid #8b8b9e;
        color: #8b8b9e;
        padding: 4px 8px;
        font-size: 11px;
        border-radius: 4px;
        cursor: pointer;
      }

      .event-log-header button:hover {
        color: white;
        border-color: white;
      }

      .event-log-entry {
        margin: 2px 0;
        line-height: 1.4;
      }

      .event-log-entry .timestamp {
        color: #666;
      }

      .event-log-entry.error {
        color: #ff6b6b;
      }

      .event-log-entry.info {
        color: #74b9ff;
      }

      /* Notice for demo mode */
      .demo-notice {
        background: #fff3cd;
        border: 1px solid #ffc107;
        color: #856404;
        padding: 12px 16px;
        margin: 16px 24px;
        border-radius: 6px;
        font-size: 14px;
      }

      .demo-notice strong {
        display: block;
        margin-bottom: 4px;
      }

      /* Hide config and notice when initialized */
      body.byof-initialized .config-panel,
      body.byof-initialized .demo-notice {
        display: none;
      }
    </style>
  </head>
  <body>
    <!-- Example page header -->
    <header class="example-header">
      <h1>BYOF Example</h1>
      <a href="https://github.com/your-org/byof" target="_blank"
        >View on GitHub</a
      >
    </header>

    <!-- Configuration panel -->
    <div class="config-panel">
      <div class="config-row">
        <div class="config-field">
          <label for="chat-endpoint">Chat Endpoint</label>
          <input
            type="url"
            id="chat-endpoint"
            value="http://localhost:3001/api/chat"
            placeholder="http://localhost:3001/api/chat"
          />
        </div>
        <div class="config-field">
          <label for="save-endpoint">Save Endpoint (optional)</label>
          <input
            type="url"
            id="save-endpoint"
            value="http://localhost:3001/api/save"
            placeholder="http://localhost:3001/api/save"
          />
        </div>
        <div class="config-field">
          <label for="api-spec-url">API Spec URL (optional)</label>
          <input
            type="url"
            id="api-spec-url"
            placeholder="https://api.example.com/openapi.json"
          />
        </div>
        <div class="config-field">
          <label for="theme-select">Theme</label>
          <select id="theme-select">
            <option value="default">Default</option>
            <option value="dark">Dark</option>
            <option value="brand">Brand Colors</option>
          </select>
        </div>
        <div class="config-field">
          <label for="auth-toggle">
            <input type="checkbox" id="auth-toggle" checked />
            Enable Auth (JWT)
          </label>
        </div>
        <div class="config-actions">
          <button class="config-btn config-btn-primary" id="init-btn">
            Initialize
          </button>
          <button
            class="config-btn config-btn-secondary"
            id="destroy-btn"
            disabled
          >
            Destroy
          </button>
        </div>
      </div>
    </div>

    <!-- Demo notice -->
    <div class="demo-notice">
      <strong>Getting Started</strong>
      <ol style="margin: 8px 0 0 20px; line-height: 1.8">
        <li>Build the SDK: <code>npm run build</code></li>
        <li>
          Start the backend:
          <code>cd examples/backend && npm install && npm start</code>
        </li>
        <li>
          In another terminal, serve from project root: <code>npx serve .</code>
        </li>
        <li>Open: <code>http://localhost:3000/examples/vanilla/</code></li>
        <li>Click "Initialize" to start BYOF</li>
        <li>
          Try prompts like: "create a dashboard", "show me a form", "list of
          users table"
        </li>
      </ol>
    </div>

    <!-- BYOF mount point -->
    <div id="byof-mount"></div>

    <!-- Event log -->
    <div class="event-log">
      <div class="event-log-header">
        <span>Event Log</span>
        <button id="clear-log-btn">Clear</button>
      </div>
      <div id="event-log-content"></div>
    </div>

    <!-- Load BYOF SDK - browser bundle with all dependencies included -->
    <script src="../../dist/index.browser.js"></script>
    <script>
      // The browser bundle exposes BYOF as a global
      const { createByof, VERSION } = BYOF

      // Demo API spec - describes the actual REST API endpoints on the backend
      // The backend (localhost:3001) implements these endpoints with in-memory data
      const demoApiSpec = JSON.stringify(
        {
          openapi: '3.0.0',
          info: {
            title: 'User Management API',
            version: '1.0.0',
            description:
              'A simple REST API for managing users. Base URL: http://localhost:3001',
          },
          servers: [
            {
              url: 'http://localhost:3001',
              description: 'Local development server',
            },
          ],
          paths: {
            '/users': {
              get: {
                summary: 'List all users',
                description: 'Returns an array of all users in the system',
                responses: {
                  200: {
                    description: 'Array of user objects',
                    content: {
                      'application/json': {
                        example: [
                          {
                            id: 1,
                            name: 'Alice Johnson',
                            email: 'alice@example.com',
                            role: 'admin',
                            createdAt: '2024-01-15T10:00:00Z',
                          },
                          {
                            id: 2,
                            name: 'Bob Smith',
                            email: 'bob@example.com',
                            role: 'user',
                            createdAt: '2024-02-20T14:30:00Z',
                          },
                        ],
                      },
                    },
                  },
                },
              },
              post: {
                summary: 'Create a new user',
                description:
                  'Creates a new user and returns the created user object',
                requestBody: {
                  required: true,
                  content: {
                    'application/json': {
                      schema: {
                        type: 'object',
                        required: ['name', 'email'],
                        properties: {
                          name: { type: 'string', example: 'John Doe' },
                          email: {
                            type: 'string',
                            format: 'email',
                            example: 'john@example.com',
                          },
                          role: {
                            type: 'string',
                            enum: ['admin', 'moderator', 'user'],
                            default: 'user',
                          },
                        },
                      },
                    },
                  },
                },
                responses: {
                  201: { description: 'User created successfully' },
                  400: { description: 'Missing required fields (name, email)' },
                  409: { description: 'Email already exists' },
                },
              },
            },
            '/users/{id}': {
              get: {
                summary: 'Get user by ID',
                description: 'Returns a single user by their ID',
                parameters: [
                  {
                    name: 'id',
                    in: 'path',
                    required: true,
                    schema: { type: 'integer' },
                  },
                ],
                responses: {
                  200: { description: 'User object' },
                  404: { description: 'User not found' },
                },
              },
              put: {
                summary: 'Update user',
                description:
                  'Updates an existing user. All fields are optional.',
                parameters: [
                  {
                    name: 'id',
                    in: 'path',
                    required: true,
                    schema: { type: 'integer' },
                  },
                ],
                requestBody: {
                  content: {
                    'application/json': {
                      schema: {
                        type: 'object',
                        properties: {
                          name: { type: 'string' },
                          email: { type: 'string', format: 'email' },
                          role: {
                            type: 'string',
                            enum: ['admin', 'moderator', 'user'],
                          },
                        },
                      },
                    },
                  },
                },
                responses: {
                  200: { description: 'Updated user object' },
                  404: { description: 'User not found' },
                  409: { description: 'Email already exists' },
                },
              },
              delete: {
                summary: 'Delete user',
                description: 'Deletes a user by their ID',
                parameters: [
                  {
                    name: 'id',
                    in: 'path',
                    required: true,
                    schema: { type: 'integer' },
                  },
                ],
                responses: {
                  204: { description: 'User deleted (no content)' },
                  404: { description: 'User not found' },
                },
              },
            },
          },
        },
        null,
        2
      )

      // Theme presets
      const themes = {
        default: {},
        dark: {
          primaryColor: '#6c5ce7',
          backgroundColor: '#1a1a2e',
          textColor: '#e0e0e0',
          borderColor: '#3a3a5e',
          errorColor: '#ff6b6b',
          successColor: '#55efc4',
          // Additional dark theme variables
          customVariables: {
            'byof-bg-secondary': '#2a2a4e',
            'byof-text-muted': '#a0a0b0',
            'byof-error-bg': '#3a2020',
          },
        },
        brand: {
          primaryColor: '#e74c3c',
          backgroundColor: '#fdf2f2',
          textColor: '#2c3e50',
          borderColor: '#fadbd8',
          successColor: '#27ae60',
        },
      }

      // State
      let byofInstance = null

      // Demo JWT token (for demonstration purposes)
      // In a real app, this would come from your auth service
      const DEMO_JWT =
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ1c2VyLTEyMyIsIm5hbWUiOiJKb2huIERvZSIsImVtYWlsIjoiam9obkBleGFtcGxlLmNvbSIsInJvbGUiOiJhZG1pbiIsImlhdCI6MTcwNDAwMDAwMCwiZXhwIjoxODA0MDAwMDAwfQ.demo-signature'

      // DOM elements
      const chatEndpointInput = document.getElementById('chat-endpoint')
      const saveEndpointInput = document.getElementById('save-endpoint')
      const apiSpecUrlInput = document.getElementById('api-spec-url')
      const themeSelect = document.getElementById('theme-select')
      const authToggle = document.getElementById('auth-toggle')
      const initBtn = document.getElementById('init-btn')
      const destroyBtn = document.getElementById('destroy-btn')
      const clearLogBtn = document.getElementById('clear-log-btn')
      const eventLogContent = document.getElementById('event-log-content')
      const mountEl = document.getElementById('byof-mount')

      // Event logging
      function logEvent(type, message, data = null) {
        const timestamp = new Date().toLocaleTimeString()
        const entry = document.createElement('div')
        entry.className = `event-log-entry ${type}`

        let text = `<span class="timestamp">[${timestamp}]</span> ${message}`
        if (data) {
          text += ` ${JSON.stringify(data)}`
        }
        entry.innerHTML = text

        eventLogContent.appendChild(entry)
        eventLogContent.scrollTop = eventLogContent.scrollHeight
      }

      // Initialize BYOF
      function initByof() {
        if (byofInstance) {
          logEvent('error', 'BYOF already initialized. Destroy first.')
          return
        }

        const chatEndpoint = chatEndpointInput.value.trim()
        if (!chatEndpoint) {
          logEvent('error', 'Chat endpoint is required')
          return
        }

        const saveEndpoint = saveEndpointInput.value.trim() || undefined
        const apiSpecUrl = apiSpecUrlInput.value.trim() || undefined
        const theme = themes[themeSelect.value] || {}

        // Use demo API spec if no URL provided
        const apiSpec = apiSpecUrl ? undefined : demoApiSpec

        logEvent('info', `Initializing BYOF v${VERSION}...`)

        // Build config object
        const config = {
          mount: mountEl,
          chatEndpoint,
          saveEndpoint,
          apiSpecUrl,
          apiSpec,
          theme,
          projectId: 'example-project',
          userId: 'example-user',
          sandbox: {
            allowlist: ['http://localhost:3001'],
          },
          onHtmlGenerated: (html, title) => {
            logEvent('info', 'HTML Generated', {
              title,
              htmlLength: html.length,
            })
          },
          onError: (error) => {
            logEvent('error', `Error: ${error.message}`, { code: error.code })
          },
          onSaveComplete: (ref) => {
            logEvent('info', 'Saved', { id: ref.id, name: ref.name })
          },
          onLoadComplete: (ref) => {
            logEvent('info', 'Loaded', { id: ref.id, name: ref.name })
          },
        }

        // Add auth if enabled
        if (authToggle.checked) {
          config.getAuthHeaders = () => {
            logEvent('info', 'Auth headers requested (JWT injected)')
            return {
              Authorization: `Bearer ${DEMO_JWT}`,
              'X-User-ID': 'user-123',
              'X-Tenant-ID': 'tenant-456',
            }
          }
        }

        try {
          byofInstance = createByof(config)

          logEvent('info', 'BYOF initialized successfully')
          initBtn.disabled = true
          destroyBtn.disabled = false
          document.body.classList.add('byof-initialized')
        } catch (err) {
          logEvent('error', `Failed to initialize: ${err.message}`)
        }
      }

      // Destroy BYOF
      function destroyByof() {
        if (!byofInstance) {
          logEvent('error', 'BYOF not initialized')
          return
        }

        byofInstance.destroy()
        byofInstance = null

        logEvent('info', 'BYOF destroyed')
        initBtn.disabled = false
        destroyBtn.disabled = true
        document.body.classList.remove('byof-initialized')
      }

      // Clear log
      function clearLog() {
        eventLogContent.innerHTML = ''
      }

      // Event listeners
      initBtn.addEventListener('click', initByof)
      destroyBtn.addEventListener('click', destroyByof)
      clearLogBtn.addEventListener('click', clearLog)

      // Auto-initialize on page load
      logEvent('info', `BYOF SDK v${VERSION} loaded`)
      logEvent('info', 'Click "Initialize" to start')
    </script>
  </body>
</html>
